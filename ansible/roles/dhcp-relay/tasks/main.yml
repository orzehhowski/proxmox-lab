- name: Install isc-dhcp-relay
  apt:
    name: isc-dhcp-relay
    state: present
    update_cache: yes

- name: Put isc-dhcp-relay config file
  template:
    src: isc-dhcp-relay.j2
    dest: /etc/default/isc-dhcp-relay
    owner: root
    group: root
    mode: 0644
  notify:
    - Restart isc-dhcp-relay service

- name: Ensure the isc-dhcp-relay service is running
  become: true
  block:
    - name: Start isc-dhcp-relay service
      systemd:
        name: isc-dhcp-relay
        state: started

    - name: Wait 3 seconds for service to settle
      pause:
        seconds: 3

    - name: Verify isc-dhcp-relay is active
      command: systemctl is-active isc-dhcp-relay
      register: process_status
      changed_when: false
      failed_when: process_status.stdout.strip() != "active"
